<!DOCTYPE HTML>
<!--
    Read Only by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>Node</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
</head>

<body>
    <!-- Header -->
    <section id="header">
        <header>
            <span class="image avatar">
                <img src="images/avatar.png" alt="" />
            </span>
            <h1 id="logo">
                <a href="#">Node</a>
            </h1>
            <p>Node.JS</p>
        </header>
        <nav id="nav">
            <ul>
                <li>
                    <a href="#intro" class="active">Introduction</a>
                </li>
                <li>
                    <a href="#what-is-node">What's NODE</a>
                </li>
                <li>
                    <a href="#nvm">NVM</a>
                </li>
                <li>
                    <a href="#npm">NPM</a>
                </li>
                <li>
                    <a href="#web-server-with-node">Web server with Node</a>
                </li>
                <li>
                    <a href="#file-system">File System (FS)</a>
                </li>
                <li>
                    <a href="#creating-router-module">Creating Router Module</a>
                </li>
                <li>
                    <a href="#events">Events</a>
                </li>
                <li>
                    <a href="#database">Database</a>
                </li>
                <li>
                    <a href="#net-module-working-with-sockets">Net module - working with Sockets</a>
                </li>
                <li>
                    <a href="#process">Process</a>
                </li>
                <li>
                    <a href="#tips">Tips</a>
                </li>
            </ul>
        </nav>
        <footer>
            Luis PÃ©rez - lperez@avenuecode.com
            <br/> Pedro Dias - pdias@avenuecode.com
        </footer>
    </section>
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Main -->
        <div id="main">

            <section id="intro">
                <div class="container">
                    <header class="major">
                        <h2>NodeJS</h2>
                        <p>Exploring Node.JS modules</p>
                        <ul>
                            <li>
                                <a href="https://nodejs.org/" target="_blank">Node.js</a>
                            </li>
                            <li>
                                <a href="https://github.com/xilenomg/training-node" target="_blank">Training Node Presentation</a>
                            </li>
                            <li>
                                <a href="https://github.com/creationix/nvm" target="_blank">NVM (Node Version Manager)</a>
                            </li>
                        </ul>
                    </header>
                    <p></p>
                </div>
            </section>

            <section id="what-is-node">
                <div class="container">
                    <h3>Node.JS</h3>
                    <section>
                        <h4>What?</h4>
                        <p>An asynchronous event driven JavaScript runtime built on Chrome's V8 JavaScript engine.</p>
                    </section>
                    <section>
                        <h4>Why?</h4>
                        <p>Non-blocking. Scalable. Javascript front and backend.</p>
                        <p>Non-blocking: Blocking methods execute synchronously and non-blocking methods execute asynchronously.
                            It means there are no worries of dead-locking the process, since there are no locks. The code
                            execution does not have to stop for I/O operation, it simply asks for I/O and gets the answer
                            once it is finished and then deals with the results - the commonly known callbacks.</p>
                        <p>Scalabe: Since it is non-blocking, multiple connections can be handle concurrently. Upon each connection
                            the callback is fired, but if there is no work to be done, Node will sleep. Because nothing blocks,
                            scalable systems are very reasonable to develop in Node.</p>
                        <p>Javascript: The same programming language you use to create your frontend you will use to build the
                            backend. It means you can use all features and functionalities of Javascript wherever you want
                            - without mentioning the community!</p>
                    </section>
                    <section>
                        <h4>How?</h4>
                        <p>Despite the fact that JavaScript is single-threaded, the event loop is what allows Node.js to perform
                            non-blocking I/O operations by offloading operations to the system kernel whenever possible.
                            The event loop is a Javascript structure responsible for taking tasks on the task queue and pushing
                            then to Javascript stack to be executed. So, in a few words, Node.js sends the tasks as soon
                            as they enter the stack to the system's APIs to be executed, after the system execute it pushes
                            the task to task queue and the the event loop, as soon as possible, send the callback to the
                            stack. That's how a single-threaded runtime can execute multiple tasks at a time - at least is
                            the idea we have.</p>
                    </section>
                    <section>
                        <h4>Some basics</h4>
                        <h5>Modules</h5>
                        <p>
                            In Node's module system, each file is treated as a separate module. That way, you can easily 
                            divide your code into modules using a project pattern or a convenient way you find most useful. When writing a module,
                            it must exposed so it can be used - or even reused - in other places inside the application. This is done by 
                            the object<code>module.exports</code>, which is created by Node's module system. Consider the following example, the <code>math.js</code> file:

<pre><code>const square = (n) => {
    return n * n;
}

module.exports = square;
</code></pre>

                            And wherever you may want to use this module, you must import it using the <i>require</i> function:
<pre><code>const sqr = require('./math');
console.log(sqr(3)); // it prints 9
</code></pre>
                            This opens for third-party modules, which the community is very strong and helpful. We'll see a little ahead that we can 
                            use a package manager to install modules that are need in our code. These modules are installed inside the <code>node_modules</code> 
                            folder of our application structure. To import these modules and any built-in module that comes shipped with Node, you don't need 
                            the relative path. Example:
                            <code>
                                const path = require('path'); // built-in
                                const express = require('express'); // 3rd party
                            </code>
                            For more information, check the <a href="https://nodejs.org/api/modules.html">modules API</a>
                        </p>
                        <h5>Process</h5>
                        <p>
                            The <code>process</code> object is a global that provides information about, and control over, the current Node.js process. As a global, 
                            it is always available to Node.js applications without using require().
                        </p>
                    </section>
                    <section>
                        <h4>Things we can do with Node</h4>
                        <p>Before we start lets understand the power of Node!</p>

                        <p>Few things you can do using NODE:</p>
                        <ol>
                            <li>HTTP/HTTPS server</li>
                            <li>Async and routine tasks</li>
                            <li>Open, read, write and remove files</li>
                            <li>Send emails</li>
                            <li>Work with Arduino</li>
                            <li>Connect to Database</li>
                        </ol>
                    </section>


                </div>
            </section>

            <section id="nvm">
                <div class="container">
                    <h3>NVM</h3>
                    <section>
                        <h4>Node Version Manager</h4>
                        <p>Easiest way to have more than one node version installed.</p>
                        <p>Follow the instructions to install at
                            <a href="https://github.com/creationix/nvm">https://github.com/creationix/nvm</a>
                        </p>
                    </section>
                    <section>
                        <h4>Important commands</h4>
                        <li>Install node version 8</li>
                        <pre><code>nvm install 8</code></pre>

                        <li>It will install latest version of node</li>
                        <pre><code>nvm install node</code></pre>

                        <li>It will use v8 of node</li>
                        <pre><code>nvm use 8</code></pre>

                        <li>Set Node v8 as default to be used in any shell</li>
                        <pre><code>nvm alias default 8</code></pre>
                    </section>
                </div>
            </section>

            <section id="npm">
                <div class="container">
                    <h3>NPM</h3>
                    <section>
                        <h4>Let's start!</h4>
                        <p>From now on, we will start using Node everytime and the most important thing is how to start it.
                            Create and go to a folder where you will add the node files.</p>
                        <p>By using your Terminal, go to this folder and let's run our first node command:</p>
                        <pre><code>npm init</code></pre>
                        <p>You will be asked few questions about this new project you are creating. if you only press Enter
                            (Return) it will use the default value inside parenthesis. </p>
                        <img src="images/npm-init.png" />
                        <p>In case all the answers are correct, press Enter again.</p>
                        <p>This process was only to generate a package.json file. </p>

                    </section>
                    <h3>Package.json</h3>
                    <section>
                        <h4>What's it?</h4>
                        <p>Basically, this file has a lot of informations about your project:</p>
                        <ol>
                            <li>Project name</li>
                            <li>Project version</li>
                            <li>Dependencies</li>
                            <li>Author</li>
                            <li>Scripts which can be ran by `npm run start` or `npm run any-script-name`</li>
                            <li>Read more at
                                <a href="https://docs.npmjs.com/files/package.json">https://docs.npmjs.com/files/package.json</a>
                            </li>
                        </ol>
                        <h5>Package.json example</h5>
                        <img src="images/package.json.png" />
                    </section>
                </div>
            </section>

            <section id="package-json">
                <div class="container">
                    
                </div>
            </section>

            <section id="web-server-with-node">
                <div class="container">
                    <h3>Web server with Node</h3>
                    <section>
                        <h4>Creating a web server with Node</h4>
                        <p>From now on, we will see more commands and the course will be more practical.</p>
                        <h5>Let's start!</h5>
                        <p>Make sure you have you terminal open on wanted folder where you will work on.</p>
                        <pre><code>echo "" > index.js</code></pre> Empty file "index.js" was created. Open it! Now write:
                        <pre><code>console.log("test");</code></pre> Go back to your terminal and type:
                        <pre><code>node index</code></pre> Result must be:
                        <pre><code>$ node index
test</code></pre>
                        <p>Now we will create our first HTTP server. Node already have a module for it. Let's request it and
                            use! Clear index.js file and add this:</p>
                        <pre><code>var http = require('http');
http.createServer(function(request, response){
    response.writeHead(200, {'Content-type': 'text/html'});
    response.end('Welcome to NODE HTTP SERVER');
}).listen(8088);</code></pre>
                        <div class="alert alert-warning">
                            Don't see anything on your terminal? It's time to open your browser and open http://localhost:8088!
                        </div>
                        <p>Are you seeing this message: "Welcome to NODE HTTP SERVER"?</p>
                    </section>

                    <section>
                        <h4>Returning 404 status</h4>
                        <p>Let's change few things on it.</p>
                        <p>Now, instead of returning status 200, let's say this page is not found and return 404. Your code
                            should looks like this now:</p>

                        <pre><code>var http = require('http');
http.createServer(function(request, response){
    response.writeHead(404, {'Content-type': 'text/html'});
    response.end('404 Not found page');
}).listen(8088);</code></pre>
                        <div class="alert alert-warning">
                            Restart your server, open Inspect Dev Tools, and refresh your page.
                        </div>
                    </section>

                    <section>
                        <h4>More ways to write something on HTML</h4>
                        <p>HTTP module also has more ways to write the response for the client, but you need to remember to
                            end the response by using</p>
                        <pre><code>response.end()</code></pre>
                        <h5>response.write</h5>
                        <pre><code>var http = require('http');
http.createServer(function(request, response){
    response.writeHead(404, {'Content-type': 'text/html'});
    response.write('<html>');
    response.write('<body>');
    response.write('&lt;h1&gt;Hello, World!&lt;/h1&gt;');
    response.write('</body>');
    response.write('</html>');
    response.end();
}).listen(8088);</code></pre> It doesn't look smart, though. What if we read this content from a file?
                    </section>
                </div>
            </section>

            <section id="file-system">
                <div class="container">
                    <h3>File System (FS)</h3>
                    <a href="https://nodejs.org/api/fs.html">https://nodejs.org/api/fs.html</a>
                    <p>The fs module provides an API for interacting with the file system in a manner closely modeled around
                        standard POSIX (Portable Operating System Interface) functions. </p>
                    <p>All file system operations have synchronous and asynchronous forms.</p>
                    <p>Some things you can do with FS:
                        <ol>
                            <li>Read files</li>
                            <li>Create files</li>
                            <li>Update files</li>
                            <li>Delete files</li>
                            <li>Rename files</li>
                        </ol>
                    </p>

                    <p>Going back to our example, we will read template.html and add it to the response.</p>
                    <p>Create a file template.html and add some html tags on it</p>
                    <pre><code>&lt;html&gt;
    &lt;head&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Welcome back again&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>

                    <p>index.js</p>
                    <pre><code>var http = require('http');
var fs = require('fs');

http.createServer(function(request, response){
    fs.readFile('template.html', function(err, data) {
    response.writeHead(200, {'Content-Type': 'text/html'});
    response.write(data);
    response.end();
    });
}).listen(8088);</code></pre>

                    <p>It's much better now, but there is something weird on it. All requests will take the client to the same
                        resource. Try it localhost:8088/your-name. We must create a Router Module</p>
                </div>
            </section>

            <section id="creating-router-module">
                <div class="container">
                    <h3>Creating Router Module</h3>
                    <p>All requests received by the server has 2 importants properties:</p>
                    <ol>
                        <li>Method</li>
                        <li>URL</li>
                    </ol>

                    <p>Method has the method name used by the client to access the resource. It could be GET, POST, PUT, DELETE,
                        OPTIONS etc.</p>
                    <p>URL is the path used by the client which we will use to route to the correct resource</p>

                    <pre><code>var http = require('http');
var fs = require('fs');

http.createServer(function(request, response){
    console.log(request.method, request.url);
    response.end();
}).listen(8088);</code></pre>

                    <p>Paste this code if you want to see the values for .method and .url. Go to your browser, refresh the page
                        and check the log on terminal.</p>

                    <p>Now, let's change it to show different contents for distinct urls.</p>

                    <p>Let's first create another template file, named as template2.html. Then we will create an IF statement
                        and the condition will be if METHOD is GET and URL is '/' or '/test</p>
                    <pre><code>var http = require('http');
var fs = require('fs');

http.createServer(function(request, response){
    console.log(request.method, request.url);
    if (request.method === 'GET' && request.url === '/') {
    fs.readFile('template.html', function(err, data) {
        response.writeHead(200, {'Content-Type': 'text/html'});
        response.write(data);
        response.end();
    });
    }
    else if (request.method === 'GET' && request.url === '/test') {
    fs.readFile('template2.html', function(err, data) {
        response.writeHead(200, {'Content-Type': 'text/html'});
        response.write(data);
        response.end();
    });
    }
}).listen(8088);</code></pre>

                    <p>Again, go to your browser and access localhost:8088 and localhost:8088/test. It should work!</p>
                    <p>It works, but we still don't have a module. Keep your code like this will work but it would be hard to
                        do any maintenance when it gets bigger.</p>
                    <p>The module we will create will handle GET and POST requests only for now, and will expect as parameter
                        only the path and the callback. The main idea is to have it like:</p>
                    <pre><code>ourModule.get('/', function(request, response){});</code></pre>
                    <pre><code>ourModule.post('/', function(request, response){});</code></pre>
                    <p>The first thing we need to do is create a modules folder within our module. Let's call it as RouterModule.</p>
                    <p>modules/router.js</p>
                    <pre><code>var routes = {
    get: {},
    post: {}
    };
    
    var router = function () {
    this.get = function (path, callback) {
        routes.get[path] = callback;
    };
    this.post = function (path, callback) {
        routes.post[path] = callback;
    };
    this.handler = function(request, response){
        var callback = routes[request.method.toLowerCase()][request.url];
        if (callback){
        callback(request, response);
        }
        else{
        response.writeHead(404);
        response.write("404 NOT FOUND");
        response.end();
        }
    };
    return this;
};

module.exports = router;</code></pre>
                    <p>index.js </p>
                    <pre><code>var http = require('http');
var fs = require('fs');
var router = require('./modules/router');
var Router = new router();

Router.get('/', function(request, response){
    fs.readFile('template.html', function(err, data) {
    response.writeHead(200, {'Content-Type': 'text/html'});
    response.write(data);
    response.end();
    });
});

Router.get('/test', function(request, response){
    fs.readFile('template2.html', function(err, data) {
    response.writeHead(200, {'Content-Type': 'text/html'});
    response.write(data);
    response.end();
    });
});

http.createServer(function(request, response){
    Router.handler(request, response);
}).listen(8088, function () {
    console.log("Server listening to port 8088");
});</code></pre>
                    <p>Using this module, our routes are now out of createServer method and was replaced by router.handler from
                        our module.</p>

                    <p>Taking a look on the module code, there are:</p>
                    <ol>
                        <li>Routes object</li>
                        <li>Router module</li>
                    </ol>

                    <p>At the end, we can see `module.exports = router`. That means we are exposing (or returning) to require caller
                        only Router Module and the rest are to be used only inside our module.</p>

                    <p>Now we know how to create our own module, let's remove all the routes from index.js. Any idea?</p>
                    <p>./routes.js</p>
                    <pre><code>var fs = require('fs');
var RouterModule = require('./modules/router');
var Router = new RouterModule();

Router.get('/', function(request, response){
    fs.readFile('template.html', function(err, data) {
    response.writeHead(200, {'Content-Type': 'text/html'});
    response.write(data);
    response.end();
    });
});

Router.get('/test', function(request, response){
    fs.readFile('template2.html', function(err, data) {
    response.writeHead(200, {'Content-Type': 'text/html'});
    response.write(data);
    response.end();
    });
});

module.exports = Router;</code></pre>
                    <p>index.js</p>
                    <pre><code>var http = require('http');
var routesSite = require('./routes');

http.createServer(function(request, response){
  routesSite.handler(request, response);
}).listen(8088, function () {
  console.log("Server listening to port 8088");
});`

Now, lets send each request to a specific controller:
routes.js
`var RouterModule = require('./modules/router');
var BaseController = require('./controllers/BaseController');
var Router = new RouterModule();

Router.get('/', function(request, response){
  BaseController.home(request, response);
});

Router.get('/test', function(request, response){
  BaseController.test(request, response);
});

module.exports = Router;</code></pre>
                    <p>controllers/BaseController.js</p>
                    <pre><code>var fs = require('fs');
var BaseController = {
  home: function (request, response) {
    fs.readFile('template.html', function (err, data) {
      response.writeHead(200, {
        'Content-Type': 'text/html'
      });
      response.write(data);
      response.end();
    });
  },
  test: function(request, response){
    fs.readFile('template2.html', function(err, data) {
      response.writeHead(200, {'Content-Type': 'text/html'});
      response.write(data);
      response.end();
    });
  }
};

module.exports = BaseController;</code></pre>
                </div>
            </section>

            <!-- Footer -->
            <section id="footer">
                <div class="container">
                    <ul class="copyright">
                        <li>&copy; Avenue Code. All rights reserved.</li>
                        <li>Design:
                            <a href="http://html5up.net">HTML5 UP</a>
                        </li>
                    </ul>
                </div>
            </section>
        </div>
        <!-- Scripts -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/jquery.scrollzer.min.js"></script>
        <script src="assets/js/jquery.scrolly.min.js"></script>
        <script src="assets/js/skel.min.js"></script>
        <script src="assets/js/util.js"></script>
        <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
        <script src="assets/js/main.js"></script>
</body>

</html>
